(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{87:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return s})),t.d(n,"metadata",(function(){return c})),t.d(n,"rightToc",(function(){return i})),t.d(n,"default",(function(){return l}));var r=t(2),o=t(6),a=(t(0),t(99)),s={id:"useConstructor",title:"useConstructor",sidebar_label:"useConstructor"},c={unversionedId:"react/useConstructor",id:"react/useConstructor",isDocsHomePage:!1,title:"useConstructor",description:"useConstructor runs a constructor function once on the first render of a component and returns a value that will stay constant across the lifetime of the component.",source:"@site/docs/react/useConstructor.md",slug:"/react/useConstructor",permalink:"/elementos-docs/docs/react/useConstructor",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/react/useConstructor.md",version:"current",sidebar_label:"useConstructor",sidebar:"main",previous:{title:"Overview",permalink:"/elementos-docs/docs/react/overview"},next:{title:"useObservable",permalink:"/elementos-docs/docs/react/useObservable"}},i=[{value:"Basic",id:"basic",children:[]},{value:"Unmounting",id:"unmounting",children:[]},{value:"Observing Props",id:"observing-props",children:[]}],u={rightToc:i};function l(e){var n=e.components,t=Object(o.a)(e,["components"]);return Object(a.b)("wrapper",Object(r.a)({},u,t,{components:n,mdxType:"MDXLayout"}),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"useConstructor")," runs a constructor function once on the first render of a component and returns a value that will stay constant across the lifetime of the component."),Object(a.b)("h3",{id:"basic"},"Basic"),Object(a.b)("p",null,"We typically do our observable creation inside of ",Object(a.b)("inlineCode",{parentName:"p"},"useConstructor")," and then return the observables from the constructor for access during the remainder of the component's lifetime."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"import { atom } from 'elementos'\nimport { useConstructor, useObservable } from 'elementos-react'\n\nfunction Username(props) {\n  const self = useConstructor(() => ({\n    username$: atom('')\n  }));\n\n  const username = useObservable(self.username$);\n\n  return (\n    <input \n      value={username} \n      onChange={(e) => {\n        self.username$.actions.set(e.target.value)\n      }}\n    />\n  );\n}\n")),Object(a.b)("h3",{id:"unmounting"},"Unmounting"),Object(a.b)("p",null,"Whenever we observe atom's, we should take care to unobserve them when a component unmounts. For this, a ",Object(a.b)("inlineCode",{parentName:"p"},"beforeUnmount")," argument is passed to the constructor. Note that ",Object(a.b)("inlineCode",{parentName:"p"},"observe")," returns a dispose function so we can simply wrap our ",Object(a.b)("inlineCode",{parentName:"p"},"observe")," call with ",Object(a.b)("inlineCode",{parentName:"p"},"beforeUnmount")," and the dispose function will be invoked before unmount."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"import React from 'react'\nimport { atom, observe } from 'elementos'\nimport { useConstructor, useObservable } from 'elementos-react'\n\nfunction Username(props) {\n  const self = useConstructor(({ beforeUnmount }) => {\n    const username$ = atom('')\n\n    beforeUnmount(\n      observe(username$, console.log)\n    )\n\n    return {\n      username$\n    }\n  });\n\n  const username = useObservable(self.username$);\n\n  return (\n    <input \n      value={username} \n      onChange={(e) => {\n        self.username$.actions.set(e.target.value)\n      }}\n    />\n  );\n}\n")),Object(a.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(a.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-heading"}),Object(a.b)("h5",{parentName:"div"},Object(a.b)("span",Object(r.a)({parentName:"h5"},{className:"admonition-icon"}),Object(a.b)("svg",Object(r.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(a.b)("path",Object(r.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(a.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-content"}),Object(a.b)("p",{parentName:"div"},"Queueing dispose functions ourselves may seem like uneccesary boilerplate, but it's in line with elementos' goals to be transparent and explicit and helps solidify our mental models of our apps. It also encourages us to decouple our state/effects from React's API, allowing for easier migrations to other frameworks."))),Object(a.b)("h3",{id:"observing-props"},"Observing Props"),Object(a.b)("p",null,"Often times we wish to observe changes to props across renders. For this, ",Object(a.b)("inlineCode",{parentName:"p"},"useConstructor")," takes a second argument, ",Object(a.b)("inlineCode",{parentName:"p"},"observed"),", which should be an object whose values will be tracked as atoms and these atoms will be passed to the constructor function."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"import React from 'react'\nimport { atom, observe } from 'elementos'\nimport { useConstructor } from 'elementos-react'\n\nfunction User(props) {\n  // Whenever props.id changes, set will be called \n  // on atoms.id with the new value\n  useConstructor(({ atoms, beforeUnmount }) => {\n    beforeUnmount(\n      observe(atoms.id, console.log)\n    )\n  }, {\n    id: props.id\n  });\n\n  return (\n    <div>...</div>\n  );\n}\n")))}l.isMDXComponent=!0},99:function(e,n,t){"use strict";t.d(n,"a",(function(){return m})),t.d(n,"b",(function(){return d}));var r=t(0),o=t.n(r);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function c(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var u=o.a.createContext({}),l=function(e){var n=o.a.useContext(u),t=n;return e&&(t="function"==typeof e?e(n):c(c({},n),e)),t},m=function(e){var n=l(e.components);return o.a.createElement(u.Provider,{value:n},e.children)},b={inlineCode:"code",wrapper:function(e){var n=e.children;return o.a.createElement(o.a.Fragment,{},n)}},p=o.a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),m=l(t),p=r,d=m["".concat(s,".").concat(p)]||m[p]||b[p]||a;return t?o.a.createElement(d,c(c({ref:n},u),{},{components:t})):o.a.createElement(d,c({ref:n},u))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,s=new Array(a);s[0]=p;var c={};for(var i in n)hasOwnProperty.call(n,i)&&(c[i]=n[i]);c.originalType=e,c.mdxType="string"==typeof e?e:r,s[1]=c;for(var u=2;u<a;u++)s[u]=t[u];return o.a.createElement.apply(null,s)}return o.a.createElement.apply(null,t)}p.displayName="MDXCreateElement"}}]);